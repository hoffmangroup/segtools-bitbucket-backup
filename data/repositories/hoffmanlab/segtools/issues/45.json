{"priority": "major", "kind": "bug", "repository": {"links": {"self": {"href": "data/repositories/hoffmanlab/segtools.json"}, "html": {"href": "#!/hoffmanlab/segtools"}, "avatar": {"href": "data/bytebucket.org/ravatar/{981b7f63-4900-4255-97c0-c244f833a3ee}ts=python"}}, "type": "repository", "name": "segtools", "full_name": "hoffmanlab/segtools", "uuid": "{981b7f63-4900-4255-97c0-c244f833a3ee}"}, "links": {"attachments": {"href": "data/repositories/hoffmanlab/segtools/issues/45/attachments_page=1.json"}, "self": {"href": "data/repositories/hoffmanlab/segtools/issues/45.json"}, "watch": {"href": "https://api.bitbucket.org/2.0/repositories/hoffmanlab/segtools/issues/45/watch"}, "comments": {"href": "data/repositories/hoffmanlab/segtools/issues/45/comments_page=1.json"}, "html": {"href": "#!/hoffmanlab/segtools/issues/45/segtools-gmtk-parameters-does-not-work"}, "vote": {"href": "https://api.bitbucket.org/2.0/repositories/hoffmanlab/segtools/issues/45/vote"}}, "reporter": {"display_name": "Rachel Chan", "uuid": "{20430f8d-4e6b-48cc-a8d8-c64868bf7e79}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B20430f8d-4e6b-48cc-a8d8-c64868bf7e79%7D"}, "html": {"href": "https://bitbucket.org/%7B20430f8d-4e6b-48cc-a8d8-c64868bf7e79%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/4397abec9f84e35f1f235b350984833dd=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsRC-1.png"}}, "nickname": "rcwchan", "type": "user", "account_id": "557058:e439e22e-8cfc-4cf1-b090-030d33a0730e"}, "title": "segtools-gmtk-parameters does not work with single-track params.params files", "component": null, "votes": 0, "watches": 1, "content": {"raw": "After a lot of debugging, I found that segtools-gmtk-parameters does not work with single-track params.params files.\r\n\r\nThis can be easily demonstrated by changing simpleseg from using 2 test tracks to just 1, and running segtools-gmtk-parameters on the params.params file found in the test's traindir/params, resulting in the following error:\r\n\r\n\r\n```\r\n#!python\r\n\r\nrachelc [ /scratch/segway-fork/segway_fork2/test/simpleseg/test-20160719.5s4ALi/traindir/params ]$ segtools-gmtk-parameters params.params \r\nINFO:Loading gmtk transitions.\r\nINFO:Opening connection to R environment.\r\nINFO:Opening connection to R environment.\r\nINFO:Saving transcript to file: gmtk_parameters/gmtk_parameters.graph.R\r\nINFO:Plotting with R function: 'save.transition'\r\nError: gmtk_parameters/gmtk_parameters.png already exists. Image will not be overwritten. Specify --clobber to overwrite.Error: gmtk_parameters/gmtk_parameters.slide.png already exists. Image will not be overwritten. Specify --clobber to overwrite.Error: gmtk_parameters/gmtk_parameters.pdf already exists. Image will not be overwritten. Specify --clobber to overwrite.Error: gmtk_parameters/gmtk_parameters.thumb.png already exists. Image will not be overwritten. Specify --clobber to overwrite.INFO:Plotting completed in 0.0 seconds\r\nINFO:Opening connection to R environment.\r\nINFO:Saving transcript to file: gmtk_parameters/gmtk_parameters.stats.R\r\nINFO:Plotting with R function: 'save.track.stats'\r\n/scratch/software/lib/python2.7/site-packages/rpy2/robjects/functions.py:106: UserWarning: Error in if (is.binary(track.stats)) { : argument is of length zero\r\n\r\n  res = super(Function, self).__call__(*new_args, **new_kwargs)\r\nCRITICAL:Encountered error within R:\r\n```\r\n\r\nThe error is caused by the following code:\r\n\r\n\r\n```\r\n#!python\r\n\r\nis.binary <- function(track.stats) {\r\n  dim(track.stats[,, \"mean\"])[2L] == 2L\r\n}\r\n```\r\n\r\nin ```segtools/R/track_statistics.R```. The reason for this error is that the ```dim(X)``` function in R only works for ```m x n, m!=1``` matrices. In contrast, the ```length(X)``` function is to be used for ```1 x n``` vectors.\r\n\r\nIn our case, m is the number of tracks and n is the number of labels.\r\n\r\nSolution is to have an if/else statement such as:\r\n\r\n\r\n```\r\n#!python\r\n\r\n710 is.binary <- function(track.stats) {\r\n711   if (is.null(dim(track.stats[,, \"mean\"]))){\r\n712     length(track.stats[,, \"mean\"])[1L] == 2L\r\n713   }\r\n714   else {\r\n715     dim(track.stats[,, \"mean\"])[2L] == 2L\r\n716   }\r\n717 }\r\n```\r\n\r\nI have already tested this to be correct. However, there appear to be other places which use the ```dim(X)``` function (or similarly don't work with 1 x n vectors) that will need to be resolved as well.", "markup": "markdown", "html": "<p>After a lot of debugging, I found that segtools-gmtk-parameters does not work with single-track params.params files.</p>\n<p>This can be easily demonstrated by changing simpleseg from using 2 test tracks to just 1, and running segtools-gmtk-parameters on the params.params file found in the test's traindir/params, resulting in the following error:</p>\n<div class=\"codehilite language-python\"><pre><span></span><span class=\"n\">rachelc</span> <span class=\"p\">[</span> <span class=\"o\">/</span><span class=\"n\">scratch</span><span class=\"o\">/</span><span class=\"n\">segway</span><span class=\"o\">-</span><span class=\"n\">fork</span><span class=\"o\">/</span><span class=\"n\">segway_fork2</span><span class=\"o\">/</span><span class=\"n\">test</span><span class=\"o\">/</span><span class=\"n\">simpleseg</span><span class=\"o\">/</span><span class=\"n\">test</span><span class=\"o\">-</span><span class=\"mf\">20160719.5</span><span class=\"n\">s4ALi</span><span class=\"o\">/</span><span class=\"n\">traindir</span><span class=\"o\">/</span><span class=\"n\">params</span> <span class=\"p\">]</span><span class=\"err\">$</span> <span class=\"n\">segtools</span><span class=\"o\">-</span><span class=\"n\">gmtk</span><span class=\"o\">-</span><span class=\"n\">parameters</span> <span class=\"n\">params</span><span class=\"o\">.</span><span class=\"n\">params</span> \n<span class=\"n\">INFO</span><span class=\"p\">:</span><span class=\"n\">Loading</span> <span class=\"n\">gmtk</span> <span class=\"n\">transitions</span><span class=\"o\">.</span>\n<span class=\"n\">INFO</span><span class=\"p\">:</span><span class=\"n\">Opening</span> <span class=\"n\">connection</span> <span class=\"n\">to</span> <span class=\"n\">R</span> <span class=\"n\">environment</span><span class=\"o\">.</span>\n<span class=\"n\">INFO</span><span class=\"p\">:</span><span class=\"n\">Opening</span> <span class=\"n\">connection</span> <span class=\"n\">to</span> <span class=\"n\">R</span> <span class=\"n\">environment</span><span class=\"o\">.</span>\n<span class=\"n\">INFO</span><span class=\"p\">:</span><span class=\"n\">Saving</span> <span class=\"n\">transcript</span> <span class=\"n\">to</span> <span class=\"nb\">file</span><span class=\"p\">:</span> <span class=\"n\">gmtk_parameters</span><span class=\"o\">/</span><span class=\"n\">gmtk_parameters</span><span class=\"o\">.</span><span class=\"n\">graph</span><span class=\"o\">.</span><span class=\"n\">R</span>\n<span class=\"n\">INFO</span><span class=\"p\">:</span><span class=\"n\">Plotting</span> <span class=\"k\">with</span> <span class=\"n\">R</span> <span class=\"n\">function</span><span class=\"p\">:</span> <span class=\"s1\">&#39;save.transition&#39;</span>\n<span class=\"n\">Error</span><span class=\"p\">:</span> <span class=\"n\">gmtk_parameters</span><span class=\"o\">/</span><span class=\"n\">gmtk_parameters</span><span class=\"o\">.</span><span class=\"n\">png</span> <span class=\"n\">already</span> <span class=\"n\">exists</span><span class=\"o\">.</span> <span class=\"n\">Image</span> <span class=\"n\">will</span> <span class=\"ow\">not</span> <span class=\"n\">be</span> <span class=\"n\">overwritten</span><span class=\"o\">.</span> <span class=\"n\">Specify</span> <span class=\"o\">--</span><span class=\"n\">clobber</span> <span class=\"n\">to</span> <span class=\"n\">overwrite</span><span class=\"o\">.</span><span class=\"n\">Error</span><span class=\"p\">:</span> <span class=\"n\">gmtk_parameters</span><span class=\"o\">/</span><span class=\"n\">gmtk_parameters</span><span class=\"o\">.</span><span class=\"n\">slide</span><span class=\"o\">.</span><span class=\"n\">png</span> <span class=\"n\">already</span> <span class=\"n\">exists</span><span class=\"o\">.</span> <span class=\"n\">Image</span> <span class=\"n\">will</span> <span class=\"ow\">not</span> <span class=\"n\">be</span> <span class=\"n\">overwritten</span><span class=\"o\">.</span> <span class=\"n\">Specify</span> <span class=\"o\">--</span><span class=\"n\">clobber</span> <span class=\"n\">to</span> <span class=\"n\">overwrite</span><span class=\"o\">.</span><span class=\"n\">Error</span><span class=\"p\">:</span> <span class=\"n\">gmtk_parameters</span><span class=\"o\">/</span><span class=\"n\">gmtk_parameters</span><span class=\"o\">.</span><span class=\"n\">pdf</span> <span class=\"n\">already</span> <span class=\"n\">exists</span><span class=\"o\">.</span> <span class=\"n\">Image</span> <span class=\"n\">will</span> <span class=\"ow\">not</span> <span class=\"n\">be</span> <span class=\"n\">overwritten</span><span class=\"o\">.</span> <span class=\"n\">Specify</span> <span class=\"o\">--</span><span class=\"n\">clobber</span> <span class=\"n\">to</span> <span class=\"n\">overwrite</span><span class=\"o\">.</span><span class=\"n\">Error</span><span class=\"p\">:</span> <span class=\"n\">gmtk_parameters</span><span class=\"o\">/</span><span class=\"n\">gmtk_parameters</span><span class=\"o\">.</span><span class=\"n\">thumb</span><span class=\"o\">.</span><span class=\"n\">png</span> <span class=\"n\">already</span> <span class=\"n\">exists</span><span class=\"o\">.</span> <span class=\"n\">Image</span> <span class=\"n\">will</span> <span class=\"ow\">not</span> <span class=\"n\">be</span> <span class=\"n\">overwritten</span><span class=\"o\">.</span> <span class=\"n\">Specify</span> <span class=\"o\">--</span><span class=\"n\">clobber</span> <span class=\"n\">to</span> <span class=\"n\">overwrite</span><span class=\"o\">.</span><span class=\"n\">INFO</span><span class=\"p\">:</span><span class=\"n\">Plotting</span> <span class=\"n\">completed</span> <span class=\"ow\">in</span> <span class=\"mf\">0.0</span> <span class=\"n\">seconds</span>\n<span class=\"n\">INFO</span><span class=\"p\">:</span><span class=\"n\">Opening</span> <span class=\"n\">connection</span> <span class=\"n\">to</span> <span class=\"n\">R</span> <span class=\"n\">environment</span><span class=\"o\">.</span>\n<span class=\"n\">INFO</span><span class=\"p\">:</span><span class=\"n\">Saving</span> <span class=\"n\">transcript</span> <span class=\"n\">to</span> <span class=\"nb\">file</span><span class=\"p\">:</span> <span class=\"n\">gmtk_parameters</span><span class=\"o\">/</span><span class=\"n\">gmtk_parameters</span><span class=\"o\">.</span><span class=\"n\">stats</span><span class=\"o\">.</span><span class=\"n\">R</span>\n<span class=\"n\">INFO</span><span class=\"p\">:</span><span class=\"n\">Plotting</span> <span class=\"k\">with</span> <span class=\"n\">R</span> <span class=\"n\">function</span><span class=\"p\">:</span> <span class=\"s1\">&#39;save.track.stats&#39;</span>\n<span class=\"o\">/</span><span class=\"n\">scratch</span><span class=\"o\">/</span><span class=\"n\">software</span><span class=\"o\">/</span><span class=\"n\">lib</span><span class=\"o\">/</span><span class=\"n\">python2</span><span class=\"o\">.</span><span class=\"mi\">7</span><span class=\"o\">/</span><span class=\"n\">site</span><span class=\"o\">-</span><span class=\"n\">packages</span><span class=\"o\">/</span><span class=\"n\">rpy2</span><span class=\"o\">/</span><span class=\"n\">robjects</span><span class=\"o\">/</span><span class=\"n\">functions</span><span class=\"o\">.</span><span class=\"n\">py</span><span class=\"p\">:</span><span class=\"mi\">106</span><span class=\"p\">:</span> <span class=\"ne\">UserWarning</span><span class=\"p\">:</span> <span class=\"n\">Error</span> <span class=\"ow\">in</span> <span class=\"k\">if</span> <span class=\"p\">(</span><span class=\"ow\">is</span><span class=\"o\">.</span><span class=\"n\">binary</span><span class=\"p\">(</span><span class=\"n\">track</span><span class=\"o\">.</span><span class=\"n\">stats</span><span class=\"p\">))</span> <span class=\"p\">{</span> <span class=\"p\">:</span> <span class=\"n\">argument</span> <span class=\"ow\">is</span> <span class=\"n\">of</span> <span class=\"n\">length</span> <span class=\"n\">zero</span>\n\n  <span class=\"n\">res</span> <span class=\"o\">=</span> <span class=\"nb\">super</span><span class=\"p\">(</span><span class=\"n\">Function</span><span class=\"p\">,</span> <span class=\"bp\">self</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"fm\">__call__</span><span class=\"p\">(</span><span class=\"o\">*</span><span class=\"n\">new_args</span><span class=\"p\">,</span> <span class=\"o\">**</span><span class=\"n\">new_kwargs</span><span class=\"p\">)</span>\n<span class=\"n\">CRITICAL</span><span class=\"p\">:</span><span class=\"n\">Encountered</span> <span class=\"n\">error</span> <span class=\"n\">within</span> <span class=\"n\">R</span><span class=\"p\">:</span>\n</pre></div>\n\n\n<p>The error is caused by the following code:</p>\n<div class=\"codehilite language-python\"><pre><span></span><span class=\"ow\">is</span><span class=\"o\">.</span><span class=\"n\">binary</span> <span class=\"o\">&lt;-</span> <span class=\"n\">function</span><span class=\"p\">(</span><span class=\"n\">track</span><span class=\"o\">.</span><span class=\"n\">stats</span><span class=\"p\">)</span> <span class=\"p\">{</span>\n  <span class=\"n\">dim</span><span class=\"p\">(</span><span class=\"n\">track</span><span class=\"o\">.</span><span class=\"n\">stats</span><span class=\"p\">[,,</span> <span class=\"s2\">&quot;mean&quot;</span><span class=\"p\">])[</span><span class=\"il\">2L</span><span class=\"p\">]</span> <span class=\"o\">==</span> <span class=\"il\">2L</span>\n<span class=\"p\">}</span>\n</pre></div>\n\n\n<p>in <code>segtools/R/track_statistics.R</code>. The reason for this error is that the <code>dim(X)</code> function in R only works for <code>m x n, m!=1</code> matrices. In contrast, the <code>length(X)</code> function is to be used for <code>1 x n</code> vectors.</p>\n<p>In our case, m is the number of tracks and n is the number of labels.</p>\n<p>Solution is to have an if/else statement such as:</p>\n<div class=\"codehilite language-python\"><pre><span></span><span class=\"mi\">710</span> <span class=\"ow\">is</span><span class=\"o\">.</span><span class=\"n\">binary</span> <span class=\"o\">&lt;-</span> <span class=\"n\">function</span><span class=\"p\">(</span><span class=\"n\">track</span><span class=\"o\">.</span><span class=\"n\">stats</span><span class=\"p\">)</span> <span class=\"p\">{</span>\n<span class=\"mi\">711</span>   <span class=\"k\">if</span> <span class=\"p\">(</span><span class=\"ow\">is</span><span class=\"o\">.</span><span class=\"n\">null</span><span class=\"p\">(</span><span class=\"n\">dim</span><span class=\"p\">(</span><span class=\"n\">track</span><span class=\"o\">.</span><span class=\"n\">stats</span><span class=\"p\">[,,</span> <span class=\"s2\">&quot;mean&quot;</span><span class=\"p\">]))){</span>\n<span class=\"mi\">712</span>     <span class=\"n\">length</span><span class=\"p\">(</span><span class=\"n\">track</span><span class=\"o\">.</span><span class=\"n\">stats</span><span class=\"p\">[,,</span> <span class=\"s2\">&quot;mean&quot;</span><span class=\"p\">])[</span><span class=\"il\">1L</span><span class=\"p\">]</span> <span class=\"o\">==</span> <span class=\"il\">2L</span>\n<span class=\"mi\">713</span>   <span class=\"p\">}</span>\n<span class=\"mi\">714</span>   <span class=\"k\">else</span> <span class=\"p\">{</span>\n<span class=\"mi\">715</span>     <span class=\"n\">dim</span><span class=\"p\">(</span><span class=\"n\">track</span><span class=\"o\">.</span><span class=\"n\">stats</span><span class=\"p\">[,,</span> <span class=\"s2\">&quot;mean&quot;</span><span class=\"p\">])[</span><span class=\"il\">2L</span><span class=\"p\">]</span> <span class=\"o\">==</span> <span class=\"il\">2L</span>\n<span class=\"mi\">716</span>   <span class=\"p\">}</span>\n<span class=\"mi\">717</span> <span class=\"p\">}</span>\n</pre></div>\n\n\n<p>I have already tested this to be correct. However, there appear to be other places which use the <code>dim(X)</code> function (or similarly don't work with 1 x n vectors) that will need to be resolved as well.</p>", "type": "rendered"}, "assignee": {"display_name": "Rachel Chan", "uuid": "{20430f8d-4e6b-48cc-a8d8-c64868bf7e79}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B20430f8d-4e6b-48cc-a8d8-c64868bf7e79%7D"}, "html": {"href": "https://bitbucket.org/%7B20430f8d-4e6b-48cc-a8d8-c64868bf7e79%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/4397abec9f84e35f1f235b350984833dd=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsRC-1.png"}}, "nickname": "rcwchan", "type": "user", "account_id": "557058:e439e22e-8cfc-4cf1-b090-030d33a0730e"}, "state": "new", "version": null, "edited_on": null, "created_on": "2016-07-19T19:44:28.345682+00:00", "milestone": null, "updated_on": "2016-07-20T16:02:53.766053+00:00", "type": "issue", "id": 45}