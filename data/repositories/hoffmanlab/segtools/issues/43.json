{"priority": "major", "kind": "bug", "repository": {"links": {"self": {"href": "data/repositories/hoffmanlab/segtools.json"}, "html": {"href": "#!/hoffmanlab/segtools"}, "avatar": {"href": "data/bytebucket.org/ravatar/{981b7f63-4900-4255-97c0-c244f833a3ee}ts=python"}}, "type": "repository", "name": "segtools", "full_name": "hoffmanlab/segtools", "uuid": "{981b7f63-4900-4255-97c0-c244f833a3ee}"}, "links": {"attachments": {"href": "data/repositories/hoffmanlab/segtools/issues/43/attachments_page=1.json"}, "self": {"href": "data/repositories/hoffmanlab/segtools/issues/43.json"}, "watch": {"href": "https://api.bitbucket.org/2.0/repositories/hoffmanlab/segtools/issues/43/watch"}, "comments": {"href": "data/repositories/hoffmanlab/segtools/issues/43/comments_page=1.json"}, "html": {"href": "#!/hoffmanlab/segtools/issues/43/plotting-with-segtools-no-longer-works"}, "vote": {"href": "https://api.bitbucket.org/2.0/repositories/hoffmanlab/segtools/issues/43/vote"}}, "reporter": {"display_name": "Rachel Chan", "uuid": "{20430f8d-4e6b-48cc-a8d8-c64868bf7e79}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B20430f8d-4e6b-48cc-a8d8-c64868bf7e79%7D"}, "html": {"href": "https://bitbucket.org/%7B20430f8d-4e6b-48cc-a8d8-c64868bf7e79%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/4397abec9f84e35f1f235b350984833dd=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsRC-1.png"}}, "nickname": "rcwchan", "type": "user", "account_id": "557058:e439e22e-8cfc-4cf1-b090-030d33a0730e"}, "title": "plotting with segtools no longer works", "component": null, "votes": 0, "watches": 1, "content": {"raw": "Problem is with rpy.rinterface's set_writeconsole function. As of [release 2.8.0](http://rpy2.readthedocs.io/en/version_2.8.x/changes.html):\r\n\r\n```\r\n#!python\r\n\r\nThe long-deprecated functions rpy2.rinterface.set_writeconsole() and rpy2.rinterface.get_writeconsole() are no longer available. One of rpy2.rinterface.set_writeconsole_regular() / rpy2.rinterface.set_writeconsole_warnerror() or rpy2.rinterface.get_writeconsole_regular() / rpy2.rinterface.get_writeconsole_warnerror() respectively should be used instead.\r\n```\r\nso the plotting function in, for example, segtools-transition (or segtools-gmtk-parameters) breaks:\r\n\r\n(in segtools/__init__.py):\r\n\r\n```\r\n#!python\r\n\r\n    def plot(self, func, *args, **kwargs):\r\n        \"\"\"Call R function but print timing information\r\n\r\n        (kept around for backwards compatibility)\r\n        \"\"\"\r\n        self.start()\r\n        log(\"Plotting with R function: %r\" % func, self.verbose)\r\n        start = time()\r\n\r\n        # Unless verbose, only print R output when there is an error\r\n        r_log = []\r\n        if self.verbose:\r\n            r_console = self._r_console\r\n        else:\r\n            r_console = lambda msg: r_log.append(str(msg))\r\n\r\n        self._rinterface.set_writeconsole(r_console)\r\n        try:\r\n            result = self.call(func, *args, **kwargs)\r\n        except self.RError:\r\n            die(\"Encoundered error within R:\\n%s\" % \"\\n  \".join(r_log))\r\n\r\n        # Return console back to stderr\r\n        self._rinterface.set_writeconsole(self._r_console)\r\n\r\n        log(\"Plotting completed in %.1f seconds\" % (time() - start),\r\n            self.verbose)\r\n        return result\r\n\r\n\r\n```\r\n\r\nwith the following error.\r\n\r\n```\r\n#!python\r\n\r\nPlotting with R function: 'save.transition'\r\nTraceback (most recent call last):\r\n  File \"/scratch/software/bin/segtools-transition\", line 9, in <module>\r\n    load_entry_point('segtools==1.1.9', 'console_scripts', 'segtools-transition')()\r\n  File \"/scratch/software/lib/python2.7/site-packages/segtools-1.1.9-py2.7.egg/segtools/transition.py\", line 350, in main\r\n    validate(*args, **kwargs)\r\n  File \"/scratch/software/lib/python2.7/site-packages/segtools-1.1.9-py2.7.egg/segtools/transition.py\", line 271, in validate\r\n    transcriptfile=transcriptfile, ropts=ropts)\r\n  File \"/scratch/software/lib/python2.7/site-packages/segtools-1.1.9-py2.7.egg/segtools/transition.py\", line 146, in save_plot\r\n    gmtk=gmtk, ropts=ropts)\r\n  File \"/scratch/software/lib/python2.7/site-packages/segtools-1.1.9-py2.7.egg/segtools/__init__.py\", line 498, in plot\r\n    self._rinterface.set_writeconsole(r_console)\r\nAttributeError: 'module' object has no attribute 'set_writeconsole'\r\n\r\n```\r\n\r\nSolution is to probably replace it with rpy2.rinterface.set_writeconsole_regular()/rpy2.rinterface.set_writeconsole_warnerror(). Unfortunately, as the change is still new, I can't find the documentation for these functions anywhere.", "markup": "markdown", "html": "<p>Problem is with rpy.rinterface's set_writeconsole function. As of <a data-is-external-link=\"true\" href=\"http://rpy2.readthedocs.io/en/version_2.8.x/changes.html\" rel=\"nofollow\">release 2.8.0</a>:</p>\n<div class=\"codehilite language-python\"><pre><span></span><span class=\"n\">The</span> <span class=\"nb\">long</span><span class=\"o\">-</span><span class=\"n\">deprecated</span> <span class=\"n\">functions</span> <span class=\"n\">rpy2</span><span class=\"o\">.</span><span class=\"n\">rinterface</span><span class=\"o\">.</span><span class=\"n\">set_writeconsole</span><span class=\"p\">()</span> <span class=\"ow\">and</span> <span class=\"n\">rpy2</span><span class=\"o\">.</span><span class=\"n\">rinterface</span><span class=\"o\">.</span><span class=\"n\">get_writeconsole</span><span class=\"p\">()</span> <span class=\"n\">are</span> <span class=\"n\">no</span> <span class=\"n\">longer</span> <span class=\"n\">available</span><span class=\"o\">.</span> <span class=\"n\">One</span> <span class=\"n\">of</span> <span class=\"n\">rpy2</span><span class=\"o\">.</span><span class=\"n\">rinterface</span><span class=\"o\">.</span><span class=\"n\">set_writeconsole_regular</span><span class=\"p\">()</span> <span class=\"o\">/</span> <span class=\"n\">rpy2</span><span class=\"o\">.</span><span class=\"n\">rinterface</span><span class=\"o\">.</span><span class=\"n\">set_writeconsole_warnerror</span><span class=\"p\">()</span> <span class=\"ow\">or</span> <span class=\"n\">rpy2</span><span class=\"o\">.</span><span class=\"n\">rinterface</span><span class=\"o\">.</span><span class=\"n\">get_writeconsole_regular</span><span class=\"p\">()</span> <span class=\"o\">/</span> <span class=\"n\">rpy2</span><span class=\"o\">.</span><span class=\"n\">rinterface</span><span class=\"o\">.</span><span class=\"n\">get_writeconsole_warnerror</span><span class=\"p\">()</span> <span class=\"n\">respectively</span> <span class=\"n\">should</span> <span class=\"n\">be</span> <span class=\"n\">used</span> <span class=\"n\">instead</span><span class=\"o\">.</span>\n</pre></div>\n\n\n<p>so the plotting function in, for example, segtools-transition (or segtools-gmtk-parameters) breaks:</p>\n<p>(in segtools/<strong>init</strong>.py):</p>\n<div class=\"codehilite language-python\"><pre><span></span>    <span class=\"k\">def</span> <span class=\"nf\">plot</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">func</span><span class=\"p\">,</span> <span class=\"o\">*</span><span class=\"n\">args</span><span class=\"p\">,</span> <span class=\"o\">**</span><span class=\"n\">kwargs</span><span class=\"p\">):</span>\n        <span class=\"sd\">&quot;&quot;&quot;Call R function but print timing information</span>\n\n<span class=\"sd\">        (kept around for backwards compatibility)</span>\n<span class=\"sd\">        &quot;&quot;&quot;</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">start</span><span class=\"p\">()</span>\n        <span class=\"n\">log</span><span class=\"p\">(</span><span class=\"s2\">&quot;Plotting with R function: </span><span class=\"si\">%r</span><span class=\"s2\">&quot;</span> <span class=\"o\">%</span> <span class=\"n\">func</span><span class=\"p\">,</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">verbose</span><span class=\"p\">)</span>\n        <span class=\"n\">start</span> <span class=\"o\">=</span> <span class=\"n\">time</span><span class=\"p\">()</span>\n\n        <span class=\"c1\"># Unless verbose, only print R output when there is an error</span>\n        <span class=\"n\">r_log</span> <span class=\"o\">=</span> <span class=\"p\">[]</span>\n        <span class=\"k\">if</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">verbose</span><span class=\"p\">:</span>\n            <span class=\"n\">r_console</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_r_console</span>\n        <span class=\"k\">else</span><span class=\"p\">:</span>\n            <span class=\"n\">r_console</span> <span class=\"o\">=</span> <span class=\"k\">lambda</span> <span class=\"n\">msg</span><span class=\"p\">:</span> <span class=\"n\">r_log</span><span class=\"o\">.</span><span class=\"n\">append</span><span class=\"p\">(</span><span class=\"nb\">str</span><span class=\"p\">(</span><span class=\"n\">msg</span><span class=\"p\">))</span>\n\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_rinterface</span><span class=\"o\">.</span><span class=\"n\">set_writeconsole</span><span class=\"p\">(</span><span class=\"n\">r_console</span><span class=\"p\">)</span>\n        <span class=\"k\">try</span><span class=\"p\">:</span>\n            <span class=\"n\">result</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">call</span><span class=\"p\">(</span><span class=\"n\">func</span><span class=\"p\">,</span> <span class=\"o\">*</span><span class=\"n\">args</span><span class=\"p\">,</span> <span class=\"o\">**</span><span class=\"n\">kwargs</span><span class=\"p\">)</span>\n        <span class=\"k\">except</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">RError</span><span class=\"p\">:</span>\n            <span class=\"n\">die</span><span class=\"p\">(</span><span class=\"s2\">&quot;Encoundered error within R:</span><span class=\"se\">\\n</span><span class=\"si\">%s</span><span class=\"s2\">&quot;</span> <span class=\"o\">%</span> <span class=\"s2\">&quot;</span><span class=\"se\">\\n</span><span class=\"s2\">  &quot;</span><span class=\"o\">.</span><span class=\"n\">join</span><span class=\"p\">(</span><span class=\"n\">r_log</span><span class=\"p\">))</span>\n\n        <span class=\"c1\"># Return console back to stderr</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_rinterface</span><span class=\"o\">.</span><span class=\"n\">set_writeconsole</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_r_console</span><span class=\"p\">)</span>\n\n        <span class=\"n\">log</span><span class=\"p\">(</span><span class=\"s2\">&quot;Plotting completed in </span><span class=\"si\">%.1f</span><span class=\"s2\"> seconds&quot;</span> <span class=\"o\">%</span> <span class=\"p\">(</span><span class=\"n\">time</span><span class=\"p\">()</span> <span class=\"o\">-</span> <span class=\"n\">start</span><span class=\"p\">),</span>\n            <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">verbose</span><span class=\"p\">)</span>\n        <span class=\"k\">return</span> <span class=\"n\">result</span>\n</pre></div>\n\n\n<p>with the following error.</p>\n<div class=\"codehilite language-python\"><pre><span></span><span class=\"n\">Plotting</span> <span class=\"k\">with</span> <span class=\"n\">R</span> <span class=\"n\">function</span><span class=\"p\">:</span> <span class=\"s1\">&#39;save.transition&#39;</span>\n<span class=\"n\">Traceback</span> <span class=\"p\">(</span><span class=\"n\">most</span> <span class=\"n\">recent</span> <span class=\"n\">call</span> <span class=\"n\">last</span><span class=\"p\">):</span>\n  <span class=\"n\">File</span> <span class=\"s2\">&quot;/scratch/software/bin/segtools-transition&quot;</span><span class=\"p\">,</span> <span class=\"n\">line</span> <span class=\"mi\">9</span><span class=\"p\">,</span> <span class=\"ow\">in</span> <span class=\"o\">&lt;</span><span class=\"n\">module</span><span class=\"o\">&gt;</span>\n    <span class=\"n\">load_entry_point</span><span class=\"p\">(</span><span class=\"s1\">&#39;segtools==1.1.9&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;console_scripts&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;segtools-transition&#39;</span><span class=\"p\">)()</span>\n  <span class=\"n\">File</span> <span class=\"s2\">&quot;/scratch/software/lib/python2.7/site-packages/segtools-1.1.9-py2.7.egg/segtools/transition.py&quot;</span><span class=\"p\">,</span> <span class=\"n\">line</span> <span class=\"mi\">350</span><span class=\"p\">,</span> <span class=\"ow\">in</span> <span class=\"n\">main</span>\n    <span class=\"n\">validate</span><span class=\"p\">(</span><span class=\"o\">*</span><span class=\"n\">args</span><span class=\"p\">,</span> <span class=\"o\">**</span><span class=\"n\">kwargs</span><span class=\"p\">)</span>\n  <span class=\"n\">File</span> <span class=\"s2\">&quot;/scratch/software/lib/python2.7/site-packages/segtools-1.1.9-py2.7.egg/segtools/transition.py&quot;</span><span class=\"p\">,</span> <span class=\"n\">line</span> <span class=\"mi\">271</span><span class=\"p\">,</span> <span class=\"ow\">in</span> <span class=\"n\">validate</span>\n    <span class=\"n\">transcriptfile</span><span class=\"o\">=</span><span class=\"n\">transcriptfile</span><span class=\"p\">,</span> <span class=\"n\">ropts</span><span class=\"o\">=</span><span class=\"n\">ropts</span><span class=\"p\">)</span>\n  <span class=\"n\">File</span> <span class=\"s2\">&quot;/scratch/software/lib/python2.7/site-packages/segtools-1.1.9-py2.7.egg/segtools/transition.py&quot;</span><span class=\"p\">,</span> <span class=\"n\">line</span> <span class=\"mi\">146</span><span class=\"p\">,</span> <span class=\"ow\">in</span> <span class=\"n\">save_plot</span>\n    <span class=\"n\">gmtk</span><span class=\"o\">=</span><span class=\"n\">gmtk</span><span class=\"p\">,</span> <span class=\"n\">ropts</span><span class=\"o\">=</span><span class=\"n\">ropts</span><span class=\"p\">)</span>\n  <span class=\"n\">File</span> <span class=\"s2\">&quot;/scratch/software/lib/python2.7/site-packages/segtools-1.1.9-py2.7.egg/segtools/__init__.py&quot;</span><span class=\"p\">,</span> <span class=\"n\">line</span> <span class=\"mi\">498</span><span class=\"p\">,</span> <span class=\"ow\">in</span> <span class=\"n\">plot</span>\n    <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_rinterface</span><span class=\"o\">.</span><span class=\"n\">set_writeconsole</span><span class=\"p\">(</span><span class=\"n\">r_console</span><span class=\"p\">)</span>\n<span class=\"ne\">AttributeError</span><span class=\"p\">:</span> <span class=\"s1\">&#39;module&#39;</span> <span class=\"nb\">object</span> <span class=\"n\">has</span> <span class=\"n\">no</span> <span class=\"n\">attribute</span> <span class=\"s1\">&#39;set_writeconsole&#39;</span>\n</pre></div>\n\n\n<p>Solution is to probably replace it with rpy2.rinterface.set_writeconsole_regular()/rpy2.rinterface.set_writeconsole_warnerror(). Unfortunately, as the change is still new, I can't find the documentation for these functions anywhere.</p>", "type": "rendered"}, "assignee": null, "state": "resolved", "version": null, "edited_on": null, "created_on": "2016-06-23T16:08:43.409966+00:00", "milestone": null, "updated_on": "2016-08-05T13:46:13.869595+00:00", "type": "issue", "id": 43}